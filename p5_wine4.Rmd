---
title: "P2"
author: "Zhang Ningning"
date: "2017/12/2"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(message=FALSE, warning = FALSE, echo = TRUE)
```


# 红酒质量分析

## 1. 关于选取的数据

### 1.1 问题: 哪些因素影响红酒口感

### 1.2 选取数据及引用
1） 选取数据: wineQualityReds.csv
[WineQualityInfo](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt)

2） 引用信息:
> This dataset is public available for research. The details are described in [Cortez et al., 2009]. 
  Please include this citation if you plan to use this database:
  P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. 
  Modeling wine preferences by data mining from physicochemical properties.
  In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.
  Available at: [@Elsevier] http://dx.doi.org/10.1016/j.dss.2009.05.016
                [Pre-press (pdf)] http://www3.dsi.uminho.pt/pcortez/winequality09.pdf
                [bib] http://www3.dsi.uminho.pt/pcortez/dss09.bib

### 1.3 数据结构
本数据集中包含1599 个红酒样本，无缺失值。11个输入的变量和一个结果变量。

#### 输入变量
- 固定酸(fixed.acidity)：品尝的出来酸（口腔里的酸）。
- 挥发性酸(volatile.acidity)：闻的到的酸，含量太高会闻起来刺鼻。
- 柠檬酸(citric.acid )：让口感更加清新。
- 残糖（residual.sugar）： 即甜度（发酵过程中，部分没有转化成酒精的糖分残留在红酒中）。甜度和酸度是会相互影响的，分析中也应该可以一起考虑。
- 氯化物（chlorides): 红酒中的盐分。氯化物含量可能是由于土壤原因导致，对大多数人来说咸味会影响红酒口感，且如果氯化物超过一定量在某些国家是不能销售的。
- 游离二氧化硫（free.sulfur.dioxide）：分子态的二氧化硫和亚硫酸氢嗯形式的二氧化硫， 起到抑制微生物污染，防止果酒变质的作用。
- 总二氧化硫(total.sulfur.dioxide) ：包含游离态和结合态的二氧化硫。二氧化硫在低浓度时几乎不会被注意到，但如果游离二氧化硫达到50ppm 以上，都会在红酒的气味和口味上有明显体现。
- 密度（density）
- pH值（pH)：酸度
- 硫酸盐(sulphates)：和二氧化硫水平有关的一种红酒添加剂，防止葡萄酒氧化。
- 酒精含量（alcohol）


#### 输出变量
- 红酒的口感品质（quality): 0-10分区间


## 2. 读取数据

```{r Read data and data summary }
# install libraries
library(ggplot2)
library(dplyr)
library(GGally)
library(gridExtra)
library(corrplot)
library(grid)

# read data
wine <- read.csv('wineQualityReds.csv')
```



## 3. 单变量分析

### 3.1 单变量图表

#### 数据概览

```{r general info about the dataset}
# general info about the dataset
dim(wine)  # Variable X is not a valid attribute
names(wine)
head(wine)
str(wine)
summary(wine)
```
正如前面提到过的，这个数据集有1599个红酒数据，无缺失值，11个输入的变量和一个结果变量。红酒品质较中庸为主，个别变量如残糖、总二氧化硫方差区别非常大，二其他一些变量如pH值，密度方差很小，所有数据集中在一个值附近。



#### 品质

```{r distribution of quality}
# distribution of quality
wine$qualityFactor <- factor(wine$quality, levels = c(0:10))

table(wine$qualityFactor)
summary(wine$qualityFactor)
ggplot(aes(x = qualityFactor), data = wine) +
  geom_bar()

```
将红酒品质转换为因子变量，为之后其他分析做准备。
数据中的红酒品质打分在3到8分之间，中位数在6, 没有表现特别糟糕也没有特别好的红酒,总体服从正态分布。

#### 酸类相关
##### 固定酸 （fixed.acidity）

```{r fixed.acidity}
# fixed.acidity
summary(wine$fixed.acidity)

q.f.acid <- qplot(fixed.acidity, data = wine, binwidth = 0.5) +
  scale_x_continuous(limits = c(0, 16), breaks = seq(0, 16, 2))
q.f.acid
```
大多数红酒固定酸含量分布在7-9(g/dm^3)之间，数据分布整体略微右偏，中间值在7.9，极值分别为4.6和15.9。


##### 挥发性酸
```{r volatile.acidity}
# volatile.acidity
summary(wine$volatile.acidity)
q.v.acid <- qplot(volatile.acidity, data = wine, binwidth = 0.05) +
  scale_x_continuous(limits = c(0, 1.6), breaks = seq(0, 1.6, .2))
q.v.acid

```
大多数红酒的挥发性酸分布在0.4-0.7g/dm^3，中位数在0.52，极值分别是0.12 和1.58.相比固定酸，挥发性酸总体含量较小。


##### 柠檬酸
```{r citric.acid}

# citric.acid
summary(wine$citric.acid)
q.c.acid <- qplot(x = citric.acid, data = wine, binwidth = 0.01)+
  scale_x_continuous(breaks= seq(0, 1, 0.1))
## all values are within 1
q.c.acid
table(wine$citric.acid)
```
柠檬酸总体含量比挥发性酸更小，有132个红酒样本中完全不含柠檬酸。通过表格可以看见，除了0附近有一个最高点之外，0.49也有一个高峰，可能这也是一个比较常见的柠檬酸标准。


##### pH
```{r pH}
summary(wine$pH)
q.ph <- qplot(pH, data = wine, binwidth = 0.01) +
  scale_x_continuous(breaks = seq(2, 4, 0.1))

```
这些红酒的pH值大多数分布在3.2到3.4之间，还是比较集中的，最酸也就是2.7， 最温和的是4.0.


##### 与酸度有关的几个变量一起看下

```{r arrange.acidity}
grid.arrange(q.f.acid, q.v.acid, q.c.acid, q.ph, ncol = 1)

```


#### 残糖
```{r residual.sugar + zoom in}

# residual.sugar
table(wine$residual.sugar)
summary(wine$residual.sugar)
qplot(residual.sugar, data = wine, binwidth = .1) +
  scale_x_continuous(breaks = seq(0, 16, 1))
## long tail and many outliers on the right side.
## can use log or squared root to transform
```
大部分红酒残糖量在1.9到2.6g / dm^3 之间。整个数据明显长尾分布，有很多异常值。尤其是大于7g / dm^3的。甜度最高的达到了15.5g / dm^3,最低的是0.9g / dm^3。
考虑到甜度和酸度会相互影响，双变量分析时可以看一下残糖和ph值得双变量关系。


```{r zoom in residual.sugar}
qplot(residual.sugar, data = wine, binwidth = .1) +
  scale_x_continuous(limits = c(0, 5), breaks = seq(0, 7, 0.5))
```
zoom in residual.sugar
放大残糖数据，忽略残糖量大于5g / dm^3的部分数据。


#### 氯化物
```{r chlorides}
# chlorides
summary(wine$chlorides)
qplot(chlorides, data = wine)

```

红酒中的盐的含量。大部分氯化物含量在0.09g / dm^3以下，部分极值非常大达到了0.61.考虑都咸味并不是一个好的特征，在双变量分析时可以看一下和品质的关系。


log10转换氯化物数据
```{r zoom in chloride log10}
# zoom in
qplot(chlorides, data = wine, binwidth = 0.01) +
  scale_x_continuous(breaks = seq(0.01, 0.6, 0.02), trans = "log10")
```


#### 二氧化硫相关
二氧化硫的含量在红酒中占比总体是非常小的，从其单位就可以看出，其他都是g/dm^3, 二氧化硫是mg/dm3。二氧化硫可以避免红酒氧化，抗菌，但同时含量过高会影响红酒的品质，尤其是压制其果香。

##### 游离二氧化硫
```{r free.sulfur.dioxide}
# free.sulfur.dioxide
summary(wine$free.sulfur.dioxide)
q.f.so2 <- qplot(free.sulfur.dioxide, data = wine)
q.f.so2
```
大多数红酒的游离二氧化硫在7-21mg / dm^3之间，异常值较多分布在偏右侧，最大二氧化硫含量达到了72mg / dm^3，而最小只有1mg / dm^3.
游离二氧化硫可以防止细菌滋生，防止葡萄酒氧化。低浓度的游离二氧化硫几乎不会被察觉到，但浓度超过50 ppm 在红酒的气味和口感上都会非常明显了。



游离二氧化硫log10转换
```{r zoom in free.sulfur.dioxide log10}
# zoom in
qplot(free.sulfur.dioxide, data = wine) +
  scale_x_continuous( trans = "log10")

```

虽然比较长尾，但log10转换似乎效果也就一般，没有明显的正态分布


##### 总二氧化硫

```{r total.sulfur.dioxide}
# total.sulfur.dioxide
summary(wine$total.sulfur.dioxide)
q.t.so2 <- qplot(total.sulfur.dioxide, data = wine) 
q.t.so2
```
总二氧化硫包含了游离二氧化硫和固定形态的二氧化硫。
大多数红酒数据的总二氧化硫分布在22-62mg / dm^3之间,样本中位数在38。但是同样，有好几个红酒数据，他们的总二氧化硫含量非常高，最高值可以达到了289mg / dm^3.


总二氧化硫log10转换 
```{r  total.sulfur.dioxide log10 }
qplot(total.sulfur.dioxide, data = wine) +
  scale_x_continuous(breaks = seq(10, 100, 10), trans = "log10")
```
相比较游离二氧化硫，转换后可以看到一个一定的正太缝补，但依然不是特别明显。感觉就好像有两层钟形曲线一样，一层高，一层低。


##### 硫酸盐
```{r sulphates}
# sulphates
summary(wine$sulphates)
q.sulp <- qplot(wine$sulphates, data = wine)
q.sulp
```
和二氧化硫水平有关的相关一种红酒添加剂，用来抗菌抗氧化。


#### 密度
```{r density}
# density
summary(wine$density)
qplot(wine$density, data = wine) 
## normal distribution, need to zoom in.

```
大部分分布在0.9956 到0.9978g / cm^3。正态分布。总体觉得密度的方差非常小，对红酒品质影响应该不大。


#### 酒精含量
```{r alcohol by volume}
# alcohol
summary(wine$alcohol)
qplot(wine$alcohol, data = wine)
class(wine$fixed.acidity)
```
大部分红酒数据的酒精含量ABV(alcohol by volume) 在9.5-11.1% 之间。其中中位数为10.2%。


##### 增加因子变量abvBucket
根据网上资料显示，ABV可以分为　　1. 含量低（少于10% ABV）, 2. 含量中偏低（10–11.5% ABV）, 3. 含量中等（11.5%–13.5% ABV）， 酒精含量中偏高（13.5%–15% ABV） ，酒精含量高（高于15% ABV）。
我觉得可以根据这个标准，将数据按酒精含量分为几个bucket,增加一个因子变量.

```{r abvBucket}
wine$abvBucket = cut(wine$alcohol, breaks = c(0, 10, 11.5, 13.5, 15, 100), labels = c("low", "medium-low", "meidum", "medium-high", "high"))  # this is not the best way to cut the buckets
summary(wine$abvBucket)
qplot(x = abvBucket, data = wine)
```
根据分析可以按出，数据中大多数红酒属于低浓度红酒，有747个，紧随其后的是中偏低浓度的，占602。没有酒精含量超过15%的红酒。


### 3.2 单变量分析小结
#### 数据集结构如何？
这个数据集有1599个红酒数据，无缺失值，11个输入的变量和一个结果变量。

##### 其他观察：
- 红酒品质：打分在3到8分之间，中位数在6,没有表现特别糟糕也没有特别好的红酒,总体服从正态分布。
- ph值： 整体较为集中在3.2到3.4之间，总体残糖分布较低在1.9到2.6g / dm^3之间，但有个别数据残糖特别大，略长尾。
- 总二氧化硫：这个数据包含了游离二氧化硫。可以看出大多数红酒数据的总二氧化硫分布在22-62mg / dm^3之间,样本中位数在38。但是同样，有好几个红酒数据，他们的总二氧化硫含量非常高，最高值可以达到了289mg / dm^3.
- 氯化物：含量也是总体偏低的，四分之三的集中在0.09g / dm^3以下，但有个别数值极高。
数据红酒的密度较为集中在0.9956 到0.9978g /cm^3.
- 酒精含量：数据中大部分红酒酒精含量较低，在11.5%以下。


#### 最关心数据集中的哪些特征变量？
本次分析我最关心的是哪些特征对红酒的品质会有较大影响。
一般来说红酒的酸甜平衡和香气是影响口感的主要因素，因此酸度，甜度相关的变量最为关心。

#### 其他哪些特征变量你觉得会对上述分析有所帮助？
通过调研红酒资料发现，二氧化硫和氯化物的含量如果太高，明显会影响红酒的口感，前者有抑制果香，后者本身就不讨喜。
酒精含量也会考虑其中，但我认为酒精含量可能和残糖也有相关性，毕竟酒精含量的多少与发酵过程有关。


#### 是否在已有变量之外增加新变量？
因为原始数据集的所有变量的数据结构都是数字类型（numeric, integer)。 为了方便分析，我增加了两个因子变量，一个是红酒品质的qualityFactor, 一个是对数据按酒精含量对数据分组的abvBucket。


#### 分析中是否有进行数据转化等处理？
单变量分析时虽然对两个二氧化硫变量进行了log10转换，但转换后并没有得到明显的分布形态。




## 4. 双变量分析
### 4.1 双变量图表
#### ggpair 看各变量之间的关系

```{r fig.width= 15, fig.height= 15}
ggpairs(wine[2:13], upper = list(continuous = wrap("cor", size =3)))
```

#### 可视化看各变量的相关系数
```{r correlation among variables}
w <- cor(subset(wine, select =fixed.acidity:quality))

corrplot(w, type = "upper")
```

从散点图，还有相关系数的的对比图可以看出，**酒精**含量与红酒品质的相关性最高，且是正相关。除此以外，**添加剂硫酸盐**，影响红酒口感清新程度的**柠檬酸**和品质也有相当大的正相关性。
在负相关方面，**挥发性酸**与红酒品质有较大的负相关性，而固定酸和口感品质则相关性较低且是正相关。
可能在品酒师的标准中，酸味在口感上是一个重要因素（且可以帮助和糖分平衡），而如果闻的到红酒的酸味，可能会较刺鼻。

#### 酒精含量和红酒品质
```{r alcohol and quality}
ggplot(aes(x = qualityFactor, y = alcohol), data = wine) +
  geom_jitter(colour = "orange", alpha = 0.5) +
  geom_boxplot(alpha = 0.25) +
  scale_y_continuous(breaks = seq(8, 14, 0.5))

```

高品质的的红酒相对酒精浓度总体相对最高，基本都在11.5%以上。但酒精浓度最低的红酒并不一定品质最差，相对低酒精的红酒打分比较中庸，较多的分布在4,5,6分之间。值得注意的是，大量数据集中在5,6分的区间。

#### 添加剂硫酸盐和红酒品质
```{r sulphates and quality}
ggplot(aes(x = qualityFactor, y = sulphates), data = wine) +
  geom_jitter(colour = "orange", alpha = 0.5) +
  geom_boxplot(alpha = 0.25) 

```
总体来看似乎也是红酒品质较高的几个样本的硫酸盐添加剂含量较高，基本都在0.75左右，而最低分的两个都在0.5稍上。同时7分和8分的硫酸盐含量中位数非常接近，只是8总体更收敛一点，这也和8分的数据较少有关。可能高品质的红酒的硫酸盐含量应该在0.75左右。如果有更多关于高品质红酒的数据可以进一步分析一下。

#### 柠檬酸和红酒品质
```{r citric.acid and quality}
ggplot(aes(x = qualityFactor, y = citric.acid), data = wine) +
  geom_jitter(colour = "orange", alpha = 0.5) +
  geom_boxplot(alpha = 0.25) +
  scale_y_continuous(limits = c(0, 0.75))

```
总体分布来说似乎是品质较高的红酒具有柠檬酸含量较高的特征，但在单变量分析和数据的分布中也可以看出，有相当一部分的样本完全不含有柠檬酸，而在含有柠檬酸的红酒中，其方差也非常大。再一次，7分和8分红酒的柠檬酸中位数都接近0.4，8分含量总体比7分偏高一点，同时7分红酒有更多的异常值。


#### 挥发性酸和红酒品质
```{r volatile.acidity and quality}
ggplot(aes(x = qualityFactor, y = volatile.acidity), data = wine) +
  geom_jitter(colour = "orange", alpha = 0.5) +
  geom_boxplot(alpha = 0.25) 

```


和相关系数的图表相对应，明显可以看出得分越高的红酒其挥发性酸的含量相对较低。同时再一次得到数据中较高得分的红酒，即7,8分的红酒其中位数非常接近都在0.4不到。这是否是一个高品质红酒中比较合适的一个挥发性酸含量，或者说这个程度的酸味是高品质红酒的气味平衡点。


#### 游离态二氧化硫的感官阀
```{r free.sulfur.dioxide and sensory threshold}
ggplot(aes(x= qualityFactor, y = free.sulfur.dioxide), data = wine) +
  geom_jitter(colour = "red", alpha = 0.5)+
  geom_boxplot(alpha= 0.25)+
  scale_y_continuous(breaks = seq(0, 60, 10))+
  geom_hline(yintercept= 50, linetype = 2, colour = "blue")

```
之前数据的输入变量时有介绍过，游离态二氧化硫的的感官阀是50ppm，超过这个值二氧化硫无论在味觉还是嗅觉上都会被明显地感受到。可以看到大多数数据都在这个感官阀之下，然而中间品质的红酒，5,6,7分却又一些异常值超过了这一感官阀。


### 4.2 双变量分析小结


#### 分析中有哪些有意思的发现？你之前感兴趣的特征和数据集其他特征之间有哪些区别么？
首先发现酒精含量，硫酸盐和柠檬酸与质量的相关性最强，都是正相关。同时，挥发性酸和红酒品质有较强的负相关关系，挥发性酸含量越高的红酒，似乎品质越差。
但是我原本最为关心的和甜度和酸度特征方面似乎与红酒品质并没有特别明显的关系。
首先，残糖与红酒品质从相关系数上看几乎无关系，而酸性指标pH值和品质也没有较为明显的关系。其次，残糖与pH值相互之间也没有很强的关系，反而和密度关系更大。
因此，我在接下来的分析中，我把关注的特征从残糖、酸性的pH值转为与红酒品质具有更强关系的几个特征，即酒精含量，硫酸盐，柠檬酸和挥发性酸酸。

#### 在你原本关心的特征之外，其他特征相互之间有哪些有意思的关系么？
游离二氧化硫和总二氧化硫有很强的正相关性，通过变量介绍可以得知，总二氧化硫包含了游离二氧化硫和结合态二氧化硫的成分。
红酒的密度与酒精含量、pH也有较明显的负相关性， 和固定酸、柠檬酸以及残糖有较强的正相关性，尤其是固定酸，这个比例尤为明显。然而出乎我意料的是，红酒的酒精含量与残糖之间似乎并没有很强的相关性。估计是之前查资料时关于发酵和残糖的理解不够准确。
在几个与酸有关系的指标之间，我觉得比较有意思的是固定酸（一个口味上的酸）和挥发性酸（一个气味上的酸）之间竟然略有负相关，而和pH值是非常强的负相关关系。而我本来以为固定酸、挥发性酸、柠檬酸和pH相互之间应该是非常强的正相关的。
还有一个特征，游离态二氧化硫，虽然其本身和品质的相关性不强，但因为他有一个感官阀概念，在可视化中可以很明显的看出这一化学成分在大多数红酒数据中都在50ppm以下，然而仍然有一小部分红酒（5,6,7分）的含量超过了这一指标，不知道影响其得分的原因是否与这一化学成分有关。

#### 哪些特征相关性最强？
与红酒品质正相关性最强的特征是酒精含量，而负相关性最强的特征是挥发性酸。


## 5. 多变量分析

### 5.1 多变量图表 


#### 固定酸，挥发性酸和红酒品质
```{r fixed.acidity， volatile.acidity， qualityFactor}
ggplot(aes(x = fixed.acidity, y = volatile.acidity, colour = qualityFactor), 
       data = wine) +
  geom_point(alpha = 0.8)+
  scale_color_brewer(type = 'seq')+
  scale_y_continuous(limits = c(0.4, 1.2))

```


固定酸和挥发性酸，一个是味觉上的酸，一个是嗅觉上的酸。将两者结合与红酒的品质进行分析，从可视化上看似乎没有看到明显的一个关系。



#### pH值，残糖和红酒品质
```{r pH， residual.sugar， qualityFactor}

pr <- ggplot(aes(x = pH, y = residual.sugar, colour = qualityFactor), 
       data = wine) +
  geom_point(alpha = 0.8)+
  scale_color_brewer(type = 'seq')

pr.zoom <- ggplot(aes(x = pH, y = residual.sugar, colour = qualityFactor), 
       data = wine) +
  geom_point(alpha = 0.8)+
  scale_color_brewer(type = 'seq') +
  scale_y_continuous(limits = c(1, 3), breaks = seq(1, 3, 0.5)) 

grid.arrange(pr, pr.zoom, ncol = 2)

```


在许多饮料中酸与甜是相互平衡的一个因素，甜味会中和掉一定的酸味，比如可乐。在这个可视化，可以看到所有数据的残糖较为集中地分布在1-3之间， 而pH值在3-3.5之间都有。图右对这一部分进行放大，仍然没有明显看出高品质红酒和低品质红酒的分布区别。 


#### 酒精含量，固定酸，红酒品质
```{r alcohol}
ggplot(aes(x = alcohol, y = fixed.acidity, colour = qualityFactor), 
       data = wine) +
  geom_point(alpha = 0.8)+ 
  scale_color_brewer(type = 'seq')

```


酒精含量和固定酸在上一部分的双变量分析中可以看出他们对红酒品质分别具有正相关性。然而将两者与红酒品质同时进行比较时，却较难看出一个比较明显的特征。


#### 酒精含量，硫酸盐，红酒品质

```{r}
ggplot(aes(x = log10(alcohol), y = log10(sulphates), colour = qualityFactor), 
       data = wine) +
  geom_point(alpha = 0.8)+ 
  scale_color_brewer(type = 'seq')+
  scale_x_continuous(lim=c(quantile(log10(wine$alcohol),
                                    0.01),
                           quantile(log10(wine$alcohol),
                                    0.99))) +
  scale_y_continuous(lim=c(quantile(log10(wine$sulphates),
                                    0.01),
                           quantile(log10(wine$sulphates),
                                    0.99)))
```


同上，酒精含量，硫酸盐与红酒品质也分别具有正相关性，在这个图表中，对两各变量分别进行了转换并对坐标轴也进行了限制，只关注1%到99%之间的数据。可以较为清晰的看到分数高的相对来说往图表右上偏，然而依然并不明显。


#### 酒精含量，挥发性酸，红酒品质

```{r alcohol, volatile.acidity, quality}
ggplot(aes(x = alcohol, y = volatile.acidity, colour = qualityFactor), 
       data = wine) +
  geom_point(alpha = 0.8)+ 
  scale_color_brewer(type = 'seq')+
  scale_x_continuous(lim=c(quantile(wine$alcohol,
                                    0.01),
                           quantile(wine$alcohol,
                                    0.99))) +
  scale_y_continuous(lim=c(quantile(wine$volatile.acidity,
                                    0.01),
                           quantile(wine$volatile.acidity,
                                    0.99)))

```


酒精含量与红酒品质是正相关，而挥发性酸与红酒品质是负相关。然而在将两个特征与红酒品质一起看的时候，发现多变量分析并没有强化这种关系。


#### 游离态二氧化硫，pH值与红酒品质

```{r free.sulfur.dioxide, pH,qualityFactor}

ggplot(aes(x= pH, y = free.sulfur.dioxide), data = wine) +
  geom_point(aes(colour = qualityFactor), alpha = 0.8)+
  scale_color_brewer(type = "seq")

```


之前网上查资料的时候有看到过，[分子态二氧化硫（游离二氧化硫中的主要成分）与pH值的关系是pH越高，其含量越](https://books.google.com/books?id=FAiCDQAAQBAJ&pg=PT69&lpg=PT69&dq=%E6%B8%B8%E7%A6%BB%E4%BA%8C%E6%B0%A7%E5%8C%96%E7%A1%AB&source=bl&ots=RCWwEu-eYj&sig=aSNkwOjlhY0Vl0-7gJGnM35bQLk&hl=zh-CN&sa=X&ved=0ahUKEwjR0Yil_vbXAhUEl5QKHU6WBl4Q6AEIQTAE#v=onepage&q=%E6%B8%B8%E7%A6%BB%E4%BA%8C%E6%B0%A7%E5%8C%96%E7%A1%AB&f=false)，然而在这个图表中并没有看到明显的负相关关系，同时似乎与红酒品质也没有特别显著的影响。


### 5.2 多变量分析小结
#### 在这一部分你有看到有哪些特别明显的关系么？有没有哪些特征相互强化了表现？

在双变量分析的基础上，对几个明显与品质有相关性的变量一起进行可视化，比如在酒精含量、固定酸、红酒品质，酒精含量、硫酸盐、固定品质这些组合中可以看到，其分布是符合双变量分析的。比如高品质红酒相对集中在酒精含量越高，固定酸含量越高的位置。但是，将两者组合在一起看并没有明显强化的表现，甚至其关系比双变量所呈现的相对分散了一点。所以我觉得这些变量会对红酒品质有影响，但并不是绝对的，而是要个别分析的。一味的把这几个与红酒品质有正相关关系的化学成分拉高，有负相关性质的化学成分压低，并不一定能够得到高品质的红酒。

#### 有没有哪些特征有令人意外的互动？
虽然双变量分析中发现残糖、pH值与红酒品质并没有很强的相关性，但我对糖酸比依然不死心，所以在多变量分析中将残糖、pH值和红酒品质再做了一个图表想看一下是否三个变量一起进行比较会有互动，然而依然没有在这里得到体现，略有些失望。我依然相信糖酸比对饮料的口味是有影响的，但不知道为什么在这一次的分析中都没有体现，可能对其他变量进行控制的情况下看红酒品质与甜酸关系会更好，或者选取的变量本身就需要更多的转换和处理。



## 6. 最终图表
### Plot 1 
```{r Quality}
ggplot(aes(x = quality), data = wine) +
  geom_bar()+
  scale_x_continuous(limits= c(0,10), breaks = seq(0,10,1))+
  labs(x = "Quality Score", title = "Red Wine Quality")

```

专业人士对红酒进行0-10分的打分，本数据的红酒主要分布在5,6之间，较为中庸。最高分为8分，最低分为3分，没有顶级品质或者特别糟糕的红酒。

### Plot 2

```{r Grid Plot}

q1<- ggplot(aes(x = qualityFactor, y = alcohol), data = wine) +
  geom_jitter(colour = "orange", alpha = 0.5) +
  geom_boxplot(alpha = 0.25) +
  scale_y_continuous(breaks = seq(8, 14, 1))+
  labs(x = "Quality", y = "Alcohol(% by volume)")


q2 <- ggplot(aes(x = qualityFactor, y = sulphates), data = wine) +
  geom_jitter(colour = "orange", alpha = 0.5) +
  geom_boxplot(alpha = 0.25)+
  labs(x = "Quality", y = "Sulphates (g / dm3)")


q3 <- ggplot(aes(x = qualityFactor, y = citric.acid), data = wine) +
  geom_jitter(colour = "orange", alpha = 0.5) +
  geom_boxplot(alpha = 0.25) +
  scale_y_continuous(limits = c(0, 0.75))+
  labs(x = "Quality", y = "Citric acid (g / dm^3)")


q4 <- ggplot(aes(x = qualityFactor, y = volatile.acidity), data = wine) +
  geom_jitter(colour = "orange", alpha = 0.5) +
  geom_boxplot(alpha = 0.25) +
  labs(x = "Quality", y = "Volatile acidity (g / dm^3)")

grid.arrange(q1, q2, q3, q4, top = textGrob("Four variables with strong correlation with wine quality"))
```


上述四个变量与红酒品质的相关性最强。

酒精浓度：高品质的的红酒相对酒精浓度总体相对最高，基本都在11.5%以上。但酒精浓度最低的红酒并不一定品质最差，相对低酒精的红酒打分比较中庸，较多的分布在4,5,6分之间。

硫酸盐添加剂：品质较高的红酒的硫酸盐添加剂含量较高，基本都在0.75左右，而最低分的两个都在0.5稍上。同时7分和8分的硫酸盐含量中位数非常接近，只是8总体更收敛一点。猜测高品质的红酒的硫酸盐含量分布在0.75g/mg^3左右。

柠檬酸： 品质较高的红酒具有柠檬酸含量较高的特征，但在单变量分析和数据的分布中也可以看出，有相当一部分的样本完全不含有柠檬酸，而在含有柠檬酸的红酒中，其方差也非常大。再一次，7分和8分红酒的柠檬酸中位数都接近0.4，8分含量总体比7分偏高一点，同时7分红酒有更多的异常值。

挥发性酸：得分越高的红酒其挥发性酸的含量相对较低。同时再一次得到数据中较高得分的红酒，即7,8分的红酒其中位数非常接近都在0.4不到。这是否是一个高品质红酒中比较合适的一个挥发性酸含量，或者说这个程度的酸味是高品质红酒的气味平衡点。


如上分析，在本数据中打分较高的红酒（7分和8分红酒），其硫酸盐，柠檬酸以及挥发性酸的中位数非常接近。可能高品质红酒的这几个化学成分在这个数值附近更容易取得高品质，同时如果希望进一步提高品质的话，可以考虑研究在这一数值进行更多研究。


### Plot 3
```{r}

ggplot(aes(x = alcohol, y = volatile.acidity, colour = qualityFactor), 
       data = wine) +
  geom_point(alpha = 0.8)+ 
  scale_color_brewer(type = 'seq',  name = "Quality")+
  scale_x_continuous(lim=c(quantile(wine$alcohol,
                                  0.01),
                         quantile(wine$alcohol,
                                  0.99)))+
  scale_y_continuous(lim=c(quantile(wine$volatile.acidity,
                                0.01),
                       quantile(wine$volatile.acidity,
                                0.99)))+
  labs(x= "Alcohol((% by volume)", y = "Volatile acidity (g / dm^3)", title = "Wine quality against alcohol and volatile acidity")

```


在所有特征中，酒精含量与红酒品质具有最强的正相关性，而挥发性酸与红酒品质具有最强的负相关性。然而通过多变量分析可以看到，这两个化学成分单独对红酒品质影响较大，然而将两个特征结合在一起看是，却发现高品质红酒并不完全集中在图表的右下部，也就是说，不是完全拉高酒精含量，拉低挥发性酸，就一定能得到好红酒。在双变量分析中较为明显的特征，在多变量分析中结合了看，却并没有较明显的关系。可能是因为，不同葡萄酒内部是有自己风味上的平衡的，双变量涉及到一个一一对应的内部平衡问题，这一点是双变量分析图表中没法体现出来的。




## 7. 思考
我觉得双变量分析时可以看到某几个特征对红酒的品质有明显的影响，但多变量分析在图表上时却很难看出。

我有两个猜想：
1. 不同的葡萄酒内部是有自己风味上的平衡的，双变量涉及到一个一一对应的内部平衡问题，这一点是双变量分析图表中没法体现出来的。
2. 在网上检索时发现有专家提出[“哈洛普说他曾经将一款白葡萄酒中的二氧化硫含量从百万分之140降低到百万分之115，他发现二氧化硫含量的降低，大大提升了葡萄酒的品质。”](http://www.wine-world.com/culture/zx/20130823105931679)。这个下调的剂量是非常小的，哪怕现有的分析单位中进行了log转换，也没有到这个数量级，而且这个下调是一个控制变量的比较，和现在的数据分析并不相同。我觉得如果对葡萄酒的影响是单变量影响更大的话，那么对某一评分的酒，甚至同一种酒，加强某种进行某种变量的控制，在这一范围内进行评分会更有效果，可能也会更有利于酿造或贮藏技术的提高。。

除此以外 ，红葡萄酒和白葡萄酒有许多相类似的特征，但取值分布却会有较大的差异，比如酸度，白葡萄酒可能会更偏酸一点等。未来可以将两个数据集结合在一起进行比较。


## 8. 参考:
1. [Introducing R ](http://data.princeton.edu/R/gettingStarted.html)
2. [数据分析？从一开始你就错了！探索性数据分析套路解读](https://zhuanlan.zhihu.com/p/29364225)
3. [Red and White Wine Quality by Daria Alekseeva](https://rstudio-pubs-static.s3.amazonaws.com/57835_c4ace81da9dc45438ad0c286bcbb4224.html)
4. [Red Wine Composition](http://waterhouse.ucdavis.edu/whats-in-wine/red-wine-composition)
5. [酸酸好滋味——详解高酸/低酸葡萄酒](http://www.wine-world.com/culture/pj/20131204171957985)
6. [从低到高，葡萄酒的酒精含量你知道多少？](http://www.wine-world.com/culture/pj/20151125093514134)
7. [Chloride concentration in red wines: influence of terroir and grape type](http://www.scielo.br/scielo.php?script=sci_arttext&pid=S0101-20612015000100095)
8. [When a wine is salty, and why it shouldn’t be](http://wineoscope.com/2015/10/02/when-a-wine-is-salty-and-why-it-shouldnt-be/)
https://stackoverflow.com/questions/29278153/plotting-with-ggplot2-error-discrete-value-supplied-to-continuous-scale
9. [Plotting with ggplot2: Error: Discrete value supplied to continuous scale](https://stackoverflow.com/questions/29278153/plotting-with-ggplot2-error-discrete-value-supplied-to-continuous-scale)
10. [Red wine quality Data Analysis](https://rpubs.com/jadianes/red-wine-quality-analysis)
11. [Red Wine Quality Analysis](https://rpubs.com/szon0111/P4)
12. [Predicting Red Wine Quality: Exploratory Data Analysis](https://rpubs.com/jeknov/redwine)
13. [Red and White Wine Analysis](https://rpubs.com/ian_xxiao/98369)
